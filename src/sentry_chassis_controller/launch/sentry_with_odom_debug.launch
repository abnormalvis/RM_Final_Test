<launch>
  <!-- Launch args for rosbag recording -->
  <arg name="bag_topic" default="/odom"/>
  <arg name="bag_dir" default="/home/idris/final_ws/src/sentry_chassis_controller/bags"/>

  <!-- Start full simulation + controllers -->
  <include file="$(find sentry_chassis_controller)/launch/sentry_pid_test_fixed.launch"/>

  <!-- Start forward kinematics node with debug output -->
  <node pkg="sentry_chassis_controller" type="forward_kinematics" name="forward_kinematics" output="screen">
    <param name="wheel_base" value="0.36"/>
    <param name="wheel_track" value="0.36"/>
    <param name="wheel_radius" value="0.05"/>
    <!-- Redundant, but clear: -->
    <remap from="/cmd_vel" to="/cmd_vel"/>
  </node>

  <!-- C++ keyboard teleop (should work) -->
  <node pkg="sentry_chassis_controller" type="sentry_control_key" name="sentry_control_key" output="screen">
    <param name="cmd_vel_topic" value="/cmd_vel"/>
    <param name="velocity_linear" value="1"/>
    <param name="velocity_angular" value="1"/>
  </node>

  <!-- Debug: Check cmd_vel traffic -->
  <node pkg="rostopic" type="rostopic" name="echo_cmd_vel"
        args="echo -p /cmd_vel"
        output="screen">
  </node>

  <!-- Debug: Check joint states -->
  <node pkg="rostopic" type="rostopic" name="joint_states_monitor"
        args="echo /joint_states -n 3"
        output="screen"/>

  <!-- Debug: Check odometry -->
  <node pkg="rostopic" type="rostopic" name="odom_monitor"
        args="echo /odom -n 2"
        output="screen"/>

  <!-- Optional: Save full debug -->
  <!-- <node pkg="rostopic" type="rostopic" name="debug_joint_states"
        args="echo /joint_states > /tmp/joint_states.log 2>&1"
        output="screen" launch-prefix="bash -c '">
  </node> -->

</launch>