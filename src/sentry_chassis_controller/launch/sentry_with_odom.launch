<launch>
  <!-- Launch args for rosbag recording -->
  <arg name="bag_topic" default="/odom"/>
  <arg name="bag_dir" default="/home/idris/final_ws/src/sentry_chassis_controller/bags"/>

  <!-- Start full simulation + controllers -->
  <include file="$(find sentry_chassis_controller)/launch/sentry_pid_test_fixed.launch"/>

  <!-- Start forward kinematics node to compute odometry from joint_states -->
  <node pkg="sentry_chassis_controller" type="forward_kinematics" name="forward_kinematics" output="screen">
    <param name="wheel_base" value="0.36"/>
    <param name="wheel_track" value="0.36"/>
    <param name="wheel_radius" value="0.05"/>
  </node>

  <!-- C++ keyboard teleop (alternate) -->
  <!-- node pkg="sentry_chassis_controller" type="sentry_control_key" name="sentry_control_key" output="screen">
    <param name="cmd_vel_topic" value="/cmd_vel"/>
    <param name="velocity_linear" value="1"/>
    <param name="velocity_angular" value="1"/>
  </node -->

  <!-- 双模式底盘控制器 -->
  <node pkg="sentry_chassis_controller" type="dual_mode_chassis_controller" name="dual_mode_chassis_controller" output="screen">
    <!-- 坐标系参数 -->
    <param name="odom_frame" value="odom"/>
    <param name="base_frame" value="base_link"/>
    <param name="control_loop_rate" value="20.0"/>  <!-- 控制循环频率 (Hz) -->
    <param name="tf_timeout" value="0.2"/>          <!-- TF查找超时时间 (s) -->
  </node>

  <!-- rosbag record launched by roslaunch, configurable via args -->
  <!-- Ensure bag dir exists and then start rosbag recording (uses bash -lc to run mkdir + rosbag) -->
  <!-- node pkg="rosbag" type="record" name="rosbag_record" output="screen" launch-prefix="/bin/bash -lc">
    <args>mkdir -p $(arg bag_dir) && rosbag record -O $(arg bag_dir)/odom $(arg bag_topic)</args>
  </node> -->

</launch>
