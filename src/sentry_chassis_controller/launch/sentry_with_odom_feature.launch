<launch>
  <!-- Launch args -->
  <arg name="bag_topic" default="/odom_controller"/>
  <arg name="bag_dir" default="/home/idris/final_ws/src/sentry_chassis_controller/bags"/>
  <arg name="inline_resolver" default="true"/>

  <!-- Include PID/controller setup -->
  <include file="$(find sentry_chassis_controller)/launch/sentry_pid_test_fixed.launch"/>

  <!-- Load teleop parameters into node namespace -->
  <rosparam file="$(find sentry_chassis_controller)/config/teleop_feature.yaml" ns="sentry_control_key_feature" command="load"/>

  <!-- Yaw publisher (decouple yaw acquisition from teleop) -->
  <node pkg="sentry_chassis_controller" type="yaw_publisher" name="yaw_publisher" output="screen">
    <param name="global_frame" value="odom"/>
    <param name="base_link_frame" value="base_link"/>
    <param name="yaw_topic" value="/robot_yaw"/>
    <param name="source" value="auto"/>
    <param name="hz" value="50"/>
    <param name="tf_timeout_sec" value="0.05"/>
    <param name="stale_sec" value="1.0"/>
    <param name="odom_topic" value="/odom_controller"/>
  </node>

  <!-- Keyboard teleop (feature variant): spinning-top default ON, quaternion->Euler yaw -->
  <node pkg="sentry_chassis_controller" type="sentry_control_key_feature" name="sentry_control_key_feature" output="screen"/>
</launch>
